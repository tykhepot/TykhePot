# TykhePot 合约规则文档

> 最后更新: 2026-02-23

## 📊 代币经济模型

### 初始分配 (总量 10亿 TPOT)
| 用途 | 比例 | 数量 | 说明 |
|------|------|------|------|
| 初始流动性 | 5% | 5000万 | DEX流动性 (合约外处理) |
| 空投池 | 10% | 1亿 | 每人100TPOT，领完即止 |
| 质押奖励池 | 35% | 3.5亿 | 质押用户奖励，耗完即止 |
| 前期奖池配额 | 20% | 2亿 | 1:1配捐，用完即止 |
| 团队代币 | 10% | 1亿 | 4年线性释放 |
| 推广奖励池 | 20% | 2亿 | 推荐奖励，耗完即止 |

### 用户存款流程
```
用户存款: 100% (扣除3%销毁)
├── 3% 记录为 pending_burn (待销毁)
└── 97% 进入奖池 + 前期配额

前期配额 (pre_match_pool):
└── 1:1 配捐 (用户投100，配100，奖池+200)
```

### 开奖分配 (奖池 100%)
```
奖池分配:
├── 平台费 2% → 自动到账平台钱包
├── 销毁 3% → 转入 burn_vault
├── 奖金 93% → 分配给用户
│   ├── 头奖 30% (1人) = 27.9%
│   ├── 二奖 20% (2人) = 各 9.3%
│   ├── 三奖 15% (3人) = 各 4.65%
│   ├── 幸运奖 10% (5人) = 各 1.86%
│   └── 普惠奖 20% (全员) = 按人头均分
└── 回流 5% → 下期奖池
```

## 🎮 奖池规则

### 小时池
- 最低存款: 200 TPOT
- 开奖时间: 每小时
- 最低参与人数: 10人

### 天池
- 最低存款: 100 TPOT
- 开奖时间: 每天 UTC 0:00
- 最低参与人数: 10人

### 开奖规则
- **<10人参与**: 奖池余额返回储备池，推荐奖励退回 referral_pool
- **>=10人参与**: 正常开奖，按比例分配奖金
- 随机数种子: timestamp + 票号 (生产需Switchboard VRF)

## 👥 推荐系统

### 奖励比例
| 角色 | 奖励 | 条件 |
|------|------|------|
| 推荐人 | 8% | 成功开奖后发放 |
| 被推荐人 | 2% (终身一次) | 成功开奖后发放 |

### 发放规则 (重要!)
1. **存款时**: 只从 referral_pool 扣减，**不立即发放**
2. **成功开奖 (>=10人)**: 从 referral_pool 提取奖励，**从奖池中发放**
3. **开奖失败 (<10人)**: 奖池退回储备池，**推荐奖励退回 referral_pool**

### 流程示例
```
用户B存款 1000 TPOT (有推荐人A):
1. 存款时: referral_pool 扣 80+20=100 TPOT (记录为 pending)
2. 成功开奖: pending 100 TPOT 进入奖池，分发给推荐人A和被推荐人B
3. 失败退款: pending 100 TPOT 退回 referral_pool

用户B使用免费投注 100 TPOT:
1. pre_match_pool 匹配 100 TPOT → 奖池 200 TPOT
2. referral_pool 扣 8+2=10 TPOT (记录为 pending)
3. 后续同上
```

## 🎁 空投机制 (免费投注)

### 新流程 (2026-02-23 改版)
1. 用户在**空投页面**注册 → 记录钱包地址到链上
2. 用户在**每日奖池**点击"免费投注" → 使用 100 TPOT 投注

### 规则
- 每个钱包只能注册一次
- 每个钱包只能使用一次免费投注
- 免费投注享受 **1:1 配捐** (从 pre_match_pool)
- 免费投注享受 **推荐人奖励 (8%)**
- 免费投注享受 **被推荐人奖励 (2%，终身一次)**

### 技术实现
- `claim_airdrop()`: 注册资格 (不发放代币)
- `deposit_daily_free()`: 免费投注 (从 pre_match_pool 扣取)

## 🔒 团队代币

### 锁定规则
- 锁定时间: 4年 (从合约初始化开始)
- 释放方式: 线性释放 (48个月)
- 释放计算: `可释放 = 总团队代币 × (已过月数 / 48)`

## 📌 合约地址

- **Devnet**: `5Mmrkgwppa2kJ93LJNuN5nmaMW3UQAVs2doaRBsjtV5b`
- **Token**: `FQwBuM6DU76rXCLrJVciS8wQUPvkS58sbtQmrxG1WgdY`
- **Frontend**: `https://www.tykhepot.io`
- **GitHub**: `github.com/tykhepot/TykhePot`

## 🔐 Switchboard VRF 集成

### 工作原理
1. 创建 Switchboard VRF 账户
2. 调用 `set_vrf_result(result)` 设置随机数
3. 开奖时优先使用 VRF 结果
4. 如果 VRF 未设置，回退到时间戳

### 费用
- 测试网: 免费
- 主网: ~0.002-0.01 SOL/次

### 合约函数

| 函数 | 说明 |
|------|------|
| initialize() | 初始化合约和各个池子 |
| deposit_hourly() | 小时池存款 |
| deposit_daily() | 天池存款 (支持推荐人) |
| deposit_daily_free() | 免费投注 (需先注册) |
| draw_hourly() | 小时池开奖 |
| draw_daily() | 天池开奖 |
| claim_airdrop() | 注册获取免费投注资格 |
| claim_team_tokens() | 团队领取锁定代币 |
| set_vrf_result() | 设置VRF随机数 |
| pause()/resume() | 暂停/恢复合约 |

## ⚠️ 待完成

- [ ] 主网上线前集成 Switchboard VRF
- [ ] 合约安全审计
- [ ] 前端 UI 完善
